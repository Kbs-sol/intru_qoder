{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/venka/Music/aph/Ubuntu_Cage/intru_in/lib/product-service.ts"],"sourcesContent":["import { nanoid } from \"nanoid\";\r\n\r\nexport interface Product {\r\n    id: string;\r\n    name: string;\r\n    description: string;\r\n    price: number;\r\n    image_url: string;\r\n    sale_price?: number;\r\n    category: string;\r\n    stock_status: \"in_stock\" | \"out_of_stock\" | \"pre_order\";\r\n    featured: boolean;\r\n    razorpay_link?: string;\r\n    created_at: string;\r\n    updated_at: string;\r\n}\r\n\r\n// Initial Mock Data\r\nlet products: Product[] = [\r\n    {\r\n        id: \"1\",\r\n        name: \"Doodles T-Shirt\",\r\n        description: \"Inspired by all the little doodles that bring warmth and joy. Fit: Oversized. Material: Premium French Terry (240 GSM). Color: White.\",\r\n        price: 1499,\r\n        sale_price: 999,\r\n        category: \"T-Shirts\",\r\n        image_url: \"https://intru.in/cdn/shop/files/3.png?v=1748692106&width=1946\",\r\n        stock_status: \"in_stock\",\r\n        featured: true,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n    },\r\n    {\r\n        id: \"2\",\r\n        name: \"No Risk Porsche\",\r\n        description: \"Designed for comfort and confidence, this statement piece merges effortless style with a bold edge. Fit: Oversized. Material: Premium French Terry (240 GSM).\",\r\n        price: 1499,\r\n        sale_price: 999,\r\n        category: \"T-Shirts\",\r\n        image_url: \"https://intru.in/cdn/shop/files/F51687B9-2BF2-43E0-988A-30272833B19E.jpg?v=1756359581&width=1920\",\r\n        stock_status: \"in_stock\",\r\n        featured: true,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n    },\r\n    {\r\n        id: \"3\",\r\n        name: \"Orange Puff Printed T-Shirt\",\r\n        description: \"Made for the coffee-obsessed. Featuring a bold puff print on premium fabric, this tee serves up comfort and caffeine-core energy.\",\r\n        price: 1499,\r\n        sale_price: 899,\r\n        category: \"T-Shirts\",\r\n        image_url: \"https://intru.in/cdn/shop/files/1_3de916a1-a217-41ee-9b2e-9e2c3130c4d6.png?v=1748190442&width=1445\",\r\n        stock_status: \"in_stock\",\r\n        featured: true,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n    },\r\n    {\r\n        id: \"4\",\r\n        name: \"Romanticise Crop Tee\",\r\n        description: \"Made to romanticise the little things â€” this cropped tee brings soft structure and breezy ease to your everyday. Material: Spandex.\",\r\n        price: 999,\r\n        sale_price: 699,\r\n        category: \"T-Shirts\",\r\n        image_url: \"https://intru.in/cdn/shop/files/4_f2aa413e-6e91-49bd-8f16-2efd41b4d6ea.png?v=1748190572&width=1946\",\r\n        stock_status: \"in_stock\",\r\n        featured: false,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n    },\r\n    {\r\n        id: \"5\",\r\n        name: \"Stripe 18 Shirt\",\r\n        description: \"Clean lines, cool tones. This loose-fit striped shirt brings relaxed structure to your look.\",\r\n        price: 1699,\r\n        sale_price: 1099,\r\n        category: \"Shirts\",\r\n        image_url: \"https://intru.in/cdn/shop/files/99.png?v=1748173436&width=1946\",\r\n        stock_status: \"in_stock\",\r\n        featured: false,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n    },\r\n    {\r\n        id: \"6\",\r\n        name: \"Summer Shirt\",\r\n        description: \"Light, airy, and made to move with you. Your sunshine staple bringing easygoing energy and warm-weather charm. Color: Butter Yellow.\",\r\n        price: 1599,\r\n        sale_price: 999,\r\n        category: \"Shirts\",\r\n        image_url: \"https://intru.in/cdn/shop/files/03.png?v=1756359941&width=1946\",\r\n        stock_status: \"in_stock\",\r\n        featured: false,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n    }\r\n];\r\n\r\nexport const productService = {\r\n    async getAll(): Promise<Product[]> {\r\n        // Simulate API delay\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n        return [...products];\r\n    },\r\n\r\n    async getById(id: string): Promise<Product | undefined> {\r\n        await new Promise(resolve => setTimeout(resolve, 200));\r\n        return products.find(p => p.id === id);\r\n    },\r\n\r\n    async create(data: Omit<Product, \"id\" | \"created_at\" | \"updated_at\">): Promise<Product> {\r\n        const newProduct: Product = {\r\n            id: nanoid(),\r\n            ...data,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n        };\r\n        products.push(newProduct);\r\n        return newProduct;\r\n    },\r\n\r\n    async update(id: string, data: Partial<Product>): Promise<Product | null> {\r\n        const index = products.findIndex(p => p.id === id);\r\n        if (index === -1) return null;\r\n\r\n        products[index] = {\r\n            ...products[index],\r\n            ...data,\r\n            updated_at: new Date().toISOString(),\r\n        };\r\n        return products[index];\r\n    },\r\n\r\n    async delete(id: string): Promise<boolean> {\r\n        const initialLength = products.length;\r\n        products = products.filter(p => p.id !== id);\r\n        return products.length !== initialLength;\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;AAiBA,oBAAoB;AACpB,IAAI,WAAsB;IACtB;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,OAAO;QACP,YAAY;QACZ,UAAU;QACV,WAAW;QACX,cAAc;QACd,UAAU;QACV,YAAY,IAAI,OAAO,WAAW;QAClC,YAAY,IAAI,OAAO,WAAW;IACtC;IACA;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,OAAO;QACP,YAAY;QACZ,UAAU;QACV,WAAW;QACX,cAAc;QACd,UAAU;QACV,YAAY,IAAI,OAAO,WAAW;QAClC,YAAY,IAAI,OAAO,WAAW;IACtC;IACA;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,OAAO;QACP,YAAY;QACZ,UAAU;QACV,WAAW;QACX,cAAc;QACd,UAAU;QACV,YAAY,IAAI,OAAO,WAAW;QAClC,YAAY,IAAI,OAAO,WAAW;IACtC;IACA;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,OAAO;QACP,YAAY;QACZ,UAAU;QACV,WAAW;QACX,cAAc;QACd,UAAU;QACV,YAAY,IAAI,OAAO,WAAW;QAClC,YAAY,IAAI,OAAO,WAAW;IACtC;IACA;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,OAAO;QACP,YAAY;QACZ,UAAU;QACV,WAAW;QACX,cAAc;QACd,UAAU;QACV,YAAY,IAAI,OAAO,WAAW;QAClC,YAAY,IAAI,OAAO,WAAW;IACtC;IACA;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,OAAO;QACP,YAAY;QACZ,UAAU;QACV,WAAW;QACX,cAAc;QACd,UAAU;QACV,YAAY,IAAI,OAAO,WAAW;QAClC,YAAY,IAAI,OAAO,WAAW;IACtC;CACH;AAEM,MAAM,iBAAiB;IAC1B,MAAM;QACF,qBAAqB;QACrB,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;QACjD,OAAO;eAAI;SAAS;IACxB;IAEA,MAAM,SAAQ,EAAU;QACpB,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;QACjD,OAAO,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACvC;IAEA,MAAM,QAAO,IAAuD;QAChE,MAAM,aAAsB;YACxB,IAAI,IAAA,2JAAM;YACV,GAAG,IAAI;YACP,YAAY,IAAI,OAAO,WAAW;YAClC,YAAY,IAAI,OAAO,WAAW;QACtC;QACA,SAAS,IAAI,CAAC;QACd,OAAO;IACX;IAEA,MAAM,QAAO,EAAU,EAAE,IAAsB;QAC3C,MAAM,QAAQ,SAAS,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAC/C,IAAI,UAAU,CAAC,GAAG,OAAO;QAEzB,QAAQ,CAAC,MAAM,GAAG;YACd,GAAG,QAAQ,CAAC,MAAM;YAClB,GAAG,IAAI;YACP,YAAY,IAAI,OAAO,WAAW;QACtC;QACA,OAAO,QAAQ,CAAC,MAAM;IAC1B;IAEA,MAAM,QAAO,EAAU;QACnB,MAAM,gBAAgB,SAAS,MAAM;QACrC,WAAW,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QACzC,OAAO,SAAS,MAAM,KAAK;IAC/B;AACJ"}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/venka/Music/aph/Ubuntu_Cage/intru_in/lib/logger.ts"],"sourcesContent":["import { nanoid } from \"nanoid\";\r\n\r\nexport type LogLevel = \"info\" | \"warning\" | \"error\";\r\n\r\nexport interface LogEntry {\r\n    user_id?: string;\r\n    action: string;\r\n    entity_type?: string;\r\n    entity_id?: string;\r\n    metadata?: Record<string, any>;\r\n    level?: LogLevel;\r\n}\r\n\r\n/**\r\n * Centralized logging service\r\n * Logs to console in development and (eventually) to D1 database in production\r\n */\r\nexport async function logActivity({\r\n    user_id,\r\n    action,\r\n    entity_type,\r\n    entity_id,\r\n    metadata,\r\n    level = \"info\",\r\n}: LogEntry) {\r\n    const timestamp = new Date().toISOString();\r\n\r\n    // In a real edge environment, we would access D1 via bindings context or an API route\r\n    // For now, in App Router server components/actions, we log to stdout which is captured by deployment logs\r\n\r\n    const logData = {\r\n        id: nanoid(),\r\n        timestamp,\r\n        level,\r\n        user_id,\r\n        action,\r\n        entity_type,\r\n        entity_id,\r\n        metadata,\r\n    };\r\n\r\n    // Structured logging for better parsing\r\n    console.log(JSON.stringify(logData));\r\n\r\n    // TODO: Insert into D1 'activity_logs' table\r\n    // This requires setting up the D1 client connection which depends on the specific runtime context (edge vs node)\r\n    // For Cloudflare Pages + Next.js, it's best to use a separate API route or server action that has the binding\r\n}\r\n\r\nexport async function logError(error: Error | string, context?: Record<string, any>) {\r\n    console.error(JSON.stringify({\r\n        timestamp: new Date().toISOString(),\r\n        level: \"error\",\r\n        message: error instanceof Error ? error.message : error,\r\n        stack: error instanceof Error ? error.stack : undefined,\r\n        context,\r\n    }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAiBO,eAAe,YAAY,EAC9B,OAAO,EACP,MAAM,EACN,WAAW,EACX,SAAS,EACT,QAAQ,EACR,QAAQ,MAAM,EACP;IACP,MAAM,YAAY,IAAI,OAAO,WAAW;IAExC,sFAAsF;IACtF,0GAA0G;IAE1G,MAAM,UAAU;QACZ,IAAI,IAAA,2JAAM;QACV;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;IAEA,wCAAwC;IACxC,QAAQ,GAAG,CAAC,KAAK,SAAS,CAAC;AAE3B,6CAA6C;AAC7C,iHAAiH;AACjH,8GAA8G;AAClH;AAEO,eAAe,SAAS,KAAqB,EAAE,OAA6B;IAC/E,QAAQ,KAAK,CAAC,KAAK,SAAS,CAAC;QACzB,WAAW,IAAI,OAAO,WAAW;QACjC,OAAO;QACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD,OAAO,iBAAiB,QAAQ,MAAM,KAAK,GAAG;QAC9C;IACJ;AACJ"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/venka/Music/aph/Ubuntu_Cage/intru_in/lib/audit.ts"],"sourcesContent":["import { logActivity } from \"./logger\";\r\n\r\nexport interface AuditEntry {\r\n    admin_id: string;\r\n    action: string;\r\n    resource_type: string;\r\n    resource_id: string;\r\n    old_value?: any;\r\n    new_value?: any;\r\n}\r\n\r\n/**\r\n * Audit logging for admin actions\r\n * Tracks data changes with before/after states\r\n */\r\nexport async function logAudit({\r\n    admin_id,\r\n    action,\r\n    resource_type,\r\n    resource_id,\r\n    old_value,\r\n    new_value,\r\n}: AuditEntry) {\r\n    await logActivity({\r\n        user_id: admin_id,\r\n        action: `ADMIN_${action}`, // Prefix for easy filtering\r\n        entity_type: resource_type,\r\n        entity_id: resource_id,\r\n        metadata: {\r\n            audit: true,\r\n            changes: {\r\n                from: old_value,\r\n                to: new_value,\r\n            },\r\n        },\r\n        level: \"warning\", // Audit logs are important\r\n    });\r\n\r\n    // TODO: Insert into specific 'audit_logs' table in D1\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAeO,eAAe,SAAS,EAC3B,QAAQ,EACR,MAAM,EACN,aAAa,EACb,WAAW,EACX,SAAS,EACT,SAAS,EACA;IACT,MAAM,IAAA,8HAAW,EAAC;QACd,SAAS;QACT,QAAQ,CAAC,MAAM,EAAE,QAAQ;QACzB,aAAa;QACb,WAAW;QACX,UAAU;YACN,OAAO;YACP,SAAS;gBACL,MAAM;gBACN,IAAI;YACR;QACJ;QACA,OAAO;IACX;AAEA,sDAAsD;AAC1D"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/venka/Music/aph/Ubuntu_Cage/intru_in/app/api/products/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { productService } from \"@/lib/product-service\";\r\nimport { getToken } from \"next-auth/jwt\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport { logAudit } from \"@/lib/audit\";\r\n\r\nexport async function GET() {\r\n    const products = await productService.getAll();\r\n    return NextResponse.json(products);\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n    // Auth check\r\n    const token = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });\r\n    if (!token || (token as any).role !== \"admin\") {\r\n        return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    try {\r\n        const body = await req.json();\r\n        const newProduct = await productService.create(body);\r\n\r\n        // Audit Log\r\n        await logAudit({\r\n            admin_id: token.sub || \"unknown\",\r\n            action: \"CREATE_PRODUCT\",\r\n            resource_type: \"product\",\r\n            resource_id: newProduct.id,\r\n            new_value: newProduct\r\n        });\r\n\r\n        return NextResponse.json(newProduct, { status: 201 });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to create product\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AAAA;AAEA;;;;;AAEO,eAAe;IAClB,MAAM,WAAW,MAAM,6IAAc,CAAC,MAAM;IAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;AAC7B;AAEO,eAAe,KAAK,GAAgB;IACvC,aAAa;IACb,MAAM,QAAQ,MAAM,IAAA,mLAAQ,EAAC;QAAE;QAAK,QAAQ,QAAQ,GAAG,CAAC,eAAe;IAAC;IACxE,IAAI,CAAC,SAAS,AAAC,MAAc,IAAI,KAAK,SAAS;QAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,aAAa,MAAM,6IAAc,CAAC,MAAM,CAAC;QAE/C,YAAY;QACZ,MAAM,IAAA,0HAAQ,EAAC;YACX,UAAU,MAAM,GAAG,IAAI;YACvB,QAAQ;YACR,eAAe;YACf,aAAa,WAAW,EAAE;YAC1B,WAAW;QACf;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,YAAY;YAAE,QAAQ;QAAI;IACvD,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAClF;AACJ"}}]
}