---
export interface Props {
  product: {
    id: string;
    name: string;
    price: number;
    sale_price: number | null;
    image_url: string;
    category: string;
  };
}

const { product } = Astro.props;

function formatPrice(amount: number): string {
  return new Intl.NumberFormat('en-IN', {
    style: 'currency', currency: 'INR', minimumFractionDigits: 0, maximumFractionDigits: 0,
  }).format(amount);
}

const displayPrice = product.sale_price ?? product.price;
---

<div class="group flex flex-col h-full">
  <div class="relative aspect-[4/5] overflow-hidden bg-gray-50 rounded-sm mb-4">
    <a href={`/products/${product.id}`} class="block w-full h-full">
      <img
        src={product.image_url}
        alt={product.name}
        loading="lazy"
        class="w-full h-full object-cover transition-transform duration-1000 ease-out group-hover:scale-110"
      />
    </a>
    {product.sale_price && (
      <div class="absolute top-3 left-3">
        <span class="bg-black text-white text-[0.625rem] font-bold px-2 py-1 uppercase tracking-tight">Sale</span>
      </div>
    )}
    <div class="absolute bottom-0 left-0 right-0 p-3 translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out z-10">
      <button
        type="button"
        x-data
        @click.stop.prevent={`$store.cart.add(${JSON.stringify({ id: product.id, name: product.name, price: product.price, sale_price: product.sale_price, image_url: product.image_url })})`}
        class="w-full bg-white/95 backdrop-blur-sm text-black py-3 text-[0.625rem] font-black uppercase tracking-widest hover:bg-black hover:text-white transition-all shadow-xl rounded-sm cursor-pointer"
      >
        Quick Add
      </button>
    </div>
  </div>
  <div class="flex flex-col gap-1.5 flex-grow">
    <a href={`/products/${product.id}`} class="group-hover:underline decoration-1 underline-offset-4">
      <h3 class="text-sm font-medium tracking-tight text-gray-900 leading-tight line-clamp-2">{product.name}</h3>
    </a>
    <div class="flex items-center gap-3">
      <span class:list={['text-sm font-bold', product.sale_price ? 'text-red-600' : 'text-gray-900']}>
        {formatPrice(displayPrice)}
      </span>
      {product.sale_price && (
        <span class="text-xs text-gray-400 line-through">{formatPrice(product.price)}</span>
      )}
    </div>
    <p class="text-[0.625rem] font-bold uppercase tracking-[0.2em] text-gray-400">{product.category}</p>
  </div>
</div>
